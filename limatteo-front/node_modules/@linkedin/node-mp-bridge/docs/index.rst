node-mp-bridge
==============

``node-mp-bridge`` is a tool for "bridging the gap" between standard JS-land
tools (like Yarn and Bower) and the LinkedIn-specific MP world.  Currently, it
provides the following features:

* Adds lockfile support to Bower [#no-bower]_.
* Automatically installs Bower components on Yarn install [#no-bower]_.
* Syncronizes Bower and Yarn lockfiles to ``product-spec.json``.

.. [#no-bower] No Bower?  No problem!  Bower support only activates if your MP
               actually uses Bower.

Installation
------------

Yarn
^^^^

To use ``node-mp-bridge`` in your MP, you must call it from your project's
lifetime hooks.  For all MPs, you'll want to add the following to your
``package.json``::

    {
      ...
      "scripts": {
        ...
        "postinstall": "node-mp-bridge yarn:postinstall --milestone 1",
        "precommit": "node-mp-bridge yarn:precommit --milestone 1"
      }
    }

In the command above, ``yarn:postinstall`` tells ``node-mp-bridge`` to run the
tasks associated with Yarn's postinstall event and ``--milestone 1`` indicates
what level of support for ``node-mp-bridge`` that your version of
``gradle-pemberly`` supports.

Git
^^^

In order to ensure that ``product-spec.json`` is correctly updated prior to
commit, you'll need to add a Git precommit hook which runs ``just yarn run
precommit``.  Currently, doing so is left as an exercise for the reader.

Bower
^^^^^

Finally, if your MP is using Bower, you will need to add lifetime hooks to your
``bower.json`` as well::

    {
      ...
      "scripts": {
        "postinstall": "node_modules/.bin/node-mp-bridge bower:postinstall --milestone 1 --components \"%\"",
        "preuninstall": "node_modules/.bin/node-mp-bridge bower:preuninstall --milestone 1 --components \"%\""
      }
    }

``bower:postinstall`` and ``bower:preuninstall`` again tell ``node-mp-bridge``
which tasks to run and ``--milestone 1`` has the same meaning as above.
``--components="%"`` is a special flag telling ``node-mp-bridge`` which
components are being changed by Bower, so that it can react appropriately.

Workflow
--------

Once ``node-mp-bridge`` is installed, you should be able to use normal Yarn and
Bower commands to get your work done.  Note that, for the time being, Yarn must
still be invoked as ``just yarn`` and that Bower must be either installed
globally or executed locally.
